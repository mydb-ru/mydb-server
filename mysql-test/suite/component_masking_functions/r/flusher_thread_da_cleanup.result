#
# PS-9611 "Assertion `!is_set() || m_can_overwrite_status' failure while server shutdown"
# https://perconadev.atlassian.net/browse/PS-9611
#
CALL mtr.add_suppression("Flusher thread terminated while waiting for session server");
CALL mtr.add_suppression("Exception during reloading dictionary cache");
CREATE TABLE mysql.masking_dictionaries(
Dictionary VARCHAR(256) NOT NULL,
Term VARCHAR(256) NOT NULL,
UNIQUE INDEX dictionary_term_idx (Dictionary, Term)
) ENGINE = InnoDB DEFAULT CHARSET=utf8mb4;
GRANT SELECT, INSERT, UPDATE, DELETE ON mysql.masking_dictionaries TO 'mysql.session'@'localhost';
INSTALL COMPONENT 'file://component_masking_functions';
# restart:<hidden args>
include/assert.inc [Turbo mode must be enabled via DBUG]
include/assert.inc [dictionaries_flush_interval_seconds must be set to 1 year]
SET debug_sync = 'now SIGNAL masking_functions_before_cache_reload_signal WAIT_FOR masking_functions_after_cache_reload_signal';
SET debug_sync = 'RESET';
# restart:<hidden args>
UNINSTALL COMPONENT 'file://component_masking_functions';
REVOKE SELECT, INSERT, UPDATE, DELETE ON mysql.masking_dictionaries FROM 'mysql.session'@'localhost';
DROP TABLE mysql.masking_dictionaries;
