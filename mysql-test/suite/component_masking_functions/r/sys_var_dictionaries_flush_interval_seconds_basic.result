CALL mtr.add_suppression("Flusher thread terminated while waiting for session server");
CALL mtr.add_suppression("Flusher thread terminated after creating internal connection");
CALL mtr.add_suppression("Server shutdown requested while attempting to establish flusher thread connection");
CALL mtr.add_suppression("option 'masking-functions.dictionaries-flush-interval-seconds':.*adjusted");
INSTALL COMPONENT 'file://component_masking_functions';
include/assert.inc [default dictionaries_flush_interval_seconds value must be 0]
include/assert.inc [flusher thread must not be running]
SET GLOBAL masking_functions.dictionaries_flush_interval_seconds = 100;
ERROR HY000: Variable 'masking_functions.dictionaries_flush_interval_seconds' is a read only variable
SET SESSION masking_functions.dictionaries_flush_interval_seconds = 100;
ERROR HY000: Variable 'masking_functions.dictionaries_flush_interval_seconds' is a read only variable
CREATE TABLE mysql.masking_dictionaries(
Dictionary VARCHAR(256) NOT NULL,
Term VARCHAR(256) NOT NULL,
UNIQUE INDEX dictionary_term_idx (Dictionary, Term)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
GRANT SELECT, INSERT, UPDATE, DELETE ON mysql.masking_dictionaries TO 'mysql.session'@'localhost';
# restart: --masking_functions.dictionaries_flush_interval_seconds=31536001
include/assert.inc [setting dictionaries_flush_interval_seconds to a value higher than 31536000 must result in clipping it to 31536000]
# restart: --masking_functions.dictionaries_flush_interval_seconds=-1
include/assert.inc [setting dictionaries_flush_interval_seconds to a value lower than 0 must result in clipping it to 0]
# restart: --masking_functions.dictionaries_flush_interval_seconds=100
include/assert.inc [dictionaries_flush_interval_seconds value after restart must be 100]
CREATE USER udftest_priv@localhost;
GRANT MASKING_DICTIONARIES_ADMIN ON *.* TO udftest_priv@localhost;
SELECT masking_dictionary_term_add('single_dict_1', 'entry_1');
masking_dictionary_term_add('single_dict_1', 'entry_1')
1
include/assert.inc [after restart flusher thread must be running]
REVOKE MASKING_DICTIONARIES_ADMIN ON *.* FROM udftest_priv@localhost;
UNINSTALL COMPONENT 'file://component_masking_functions';
REVOKE SELECT, INSERT, UPDATE, DELETE ON mysql.masking_dictionaries FROM 'mysql.session'@'localhost';
DROP USER udftest_priv@localhost;
DROP TABLE mysql.masking_dictionaries;
# restart
